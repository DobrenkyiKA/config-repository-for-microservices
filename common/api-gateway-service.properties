spring.application.name=api-gateway-service
server.port=8090

# Gateway routes configuration
spring.cloud.gateway.discovery.locator.enabled=true
spring.cloud.gateway.discovery.locator.lower-case-service-id=true

# Route to resource-service
spring.cloud.gateway.routes[0].id=resource-service
spring.cloud.gateway.routes[0].uri=lb://resource-service
spring.cloud.gateway.routes[0].predicates[0]=Path=/resources/**, /buckets/**

# Route to song-service
spring.cloud.gateway.routes[1].id=song-service
spring.cloud.gateway.routes[1].uri=lb://song-service
spring.cloud.gateway.routes[1].predicates[0]=Path=/songs/**

# Route to resource-processor
spring.cloud.gateway.routes[2].id=resource-processor
spring.cloud.gateway.routes[2].uri=lb://resource-processor
spring.cloud.gateway.routes[2].predicates[0]=Path=/processor/**

# Actuator configuration
management.endpoints.web.exposure.include=health,info,gateway

# Circuit Breaker Configuration
resilience4j.circuitbreaker.instances.resource-service-cb.slidingWindowSize=10
resilience4j.circuitbreaker.instances.resource-service-cb.minimumNumberOfCalls=5
resilience4j.circuitbreaker.instances.resource-service-cb.failureRateThreshold=50
resilience4j.circuitbreaker.instances.resource-service-cb.waitDurationInOpenState=30s
resilience4j.circuitbreaker.instances.resource-service-cb.slowCallRateThreshold=50
resilience4j.circuitbreaker.instances.resource-service-cb.slowCallDurationThreshold=5s
resilience4j.circuitbreaker.instances.resource-service-cb.permittedNumberOfCallsInHalfOpenState=3

resilience4j.circuitbreaker.instances.song-service-cb.slidingWindowSize=10
resilience4j.circuitbreaker.instances.song-service-cb.minimumNumberOfCalls=5
resilience4j.circuitbreaker.instances.song-service-cb.failureRateThreshold=50
resilience4j.circuitbreaker.instances.song-service-cb.waitDurationInOpenState=30s
resilience4j.circuitbreaker.instances.song-service-cb.slowCallRateThreshold=50
resilience4j.circuitbreaker.instances.song-service-cb.slowCallDurationThreshold=5s
resilience4j.circuitbreaker.instances.song-service-cb.permittedNumberOfCallsInHalfOpenState=3

resilience4j.circuitbreaker.instances.resource-processor-cb.slidingWindowSize=10
resilience4j.circuitbreaker.instances.resource-processor-cb.minimumNumberOfCalls=5
resilience4j.circuitbreaker.instances.resource-processor-cb.failureRateThreshold=50
resilience4j.circuitbreaker.instances.resource-processor-cb.waitDurationInOpenState=30s
resilience4j.circuitbreaker.instances.resource-processor-cb.slowCallRateThreshold=50
resilience4j.circuitbreaker.instances.resource-processor-cb.slowCallDurationThreshold=5s
resilience4j.circuitbreaker.instances.resource-processor-cb.permittedNumberOfCallsInHalfOpenState=3

# Time Limiter Configuration
resilience4j.timelimiter.instances.resource-service-cb.timeoutDuration=10s
resilience4j.timelimiter.instances.song-service-cb.timeoutDuration=10s
resilience4j.timelimiter.instances.resource-processor-cb.timeoutDuration=10s

# Gateway timeout settings
spring.cloud.gateway.httpclient.connect-timeout=5000
spring.cloud.gateway.httpclient.response-timeout=10s

# Error handling configuration
spring.cloud.gateway.default-filters[0]=DedupeResponseHeader=Access-Control-Allow-Credentials Access-Control-Allow-Origin
server.error.include-stacktrace=never
server.error.include-message=on_param

# Logging
logging.level.org.springframework.cloud.gateway=DEBUG
logging.level.org.springframework.cloud.circuitbreaker=DEBUG